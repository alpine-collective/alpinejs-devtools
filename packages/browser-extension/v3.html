<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Alpine.js Devtools v3</title>
    <!-- Devtools support v3 without using it internally for the devtools panel (for now)
            so we have to load from CDN
         -->
    <!-- <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script> -->
    <!-- Uncomment the following script to use that version, eg. when working offline -->
    <script src="/cdn.min.js" defer></script>
  </head>

  <body>
    <div
      x-data="{
                el: $el,
                els: [$el],
                nestedUnserializable: { el: $el, nestedFn() {}, array: [ { hello: 'world' }] },
                myFunction() { return true },
                bool: true,
                num: 5,
                str: 'string',
                arr: ['world', 'bar'],
                nestedObjArr: { array: [ { nested: 'property' }] },
            }"
    >
      <div>sampleStore.on <span x-text="$store.sampleStore.on"></span></div>
      <div>sampleStore.nested <span x-text="JSON.stringify($store.sampleStore.nested)"></span></div>
      <div>primitiveVal <span x-text="JSON.stringify($store.primitiveVal)"></span></div>
      <div>
        Bool, type: "<span x-text="typeof bool"></span>", value: "<span x-text="bool"></span>"
      </div>
      <div>Num, type: "<span x-text="typeof num"></span>", value: "<span x-text="num"></span>"</div>
      <div>Str, type: "<span x-text="typeof str"></span>", value: "<span x-text="str"></span>"</div>
      <div>
        Arr, type: "<span x-text="typeof arr"></span>", value (stringified): "<span
          x-text="JSON.stringify(arr)"
        ></span
        >"
      </div>
      <div>
        Nested serializable array/object value (stringified): "<span
          data-testid="nested-obj-arr"
          x-text="JSON.stringify(nestedObjArr)"
        ></span
        >"
      </div>
    </div>
    <!-- can be used to test jQuery interop stuff -->
    <!--
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <div name="jQuery-test" x-data="{ el: $($el) }"></div>
        -->
    <div id="app" x-data="{ hello: 'world' }">
      <span x-text="hello"></span>
    </div>
    <div x-data="myFn()">
      <span x-text="hello"></span>
    </div>
    <div name="component" x-data="{ hello: 'world' }">
      <span x-text="hello"></span>
    </div>
    <div role="combobox" x-data="{ hello: 'world' }">
      <span x-text="hello"></span>
      <div x-data x-title="nested1">
        Nesting 1
        <div x-data x-title="nested2">Nesting 2</div>
      </div>
    </div>
    <div
      x-title="model-no-render"
      x-data="{ text: 'initial', model: { nested: 'nested-initial' } }"
    >
      <label>
        Doesn't re-render but has x-model
        <input type="text" x-model="text" data-testid="model-no-render" />
      </label>
      <label>
        x-model on nested value
        <input type="text" x-model="model.nested" data-testid="nested-model-no-render" />
      </label>
    </div>
    <button
      data-testid="replace-component-button"
      onclick="event.target.parentNode.replaceChild(window.span, event.target)"
      x-data
      x-title="Replaceable"
    >
      Press to replace self with a new component
    </button>
    <br />
    <button
      x-data
      x-title="Inserts others"
      data-testid="add-component-button"
      onclick="event.target.insertAdjacentHTML(
                'afterend',
                `
                <button data-testid='delete-component-button' onclick='event.target.remove()' x-data x-title='Inserted'>Press to remove self</button>
                `
            )"
    >
      Add new component
    </button>
    <br />
    <script>
      // For testing inserting. Will insert anywhere.
      window.span = document.createElement('span');
      window.span.setAttribute('x-data', '');
      window.span.setAttribute('x-title', 'Span');
      window.span.setAttribute('x-text', `"I'm an Alpine component"`);
    </script>
    <script>
      function myFn() {
        return {
          hello: 'world',
        };
      }
    </script>
    <button data-testid="inject-broken" onclick="injectBroken(event.target)">
      Inject broken component
    </button>

    <script>
      function injectBroken(target) {
        target.insertAdjacentHTML('afterend', `<div x-data="{ foo: 'aaa' ">Broken x-data</div>`);
      }
    </script>
    <button data-testid="broken-click" x-data x-on:click="foo.bar.baz">Broken x-on:click</button>
    <div>
      <a data-testid="navigation-target" href="/navigation-target.html">Go to next page</a>
    </div>

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.store('sampleStore', {
          nested: {
            array: ['123', '345'],
          },
          on: false,

          toggle() {
            this.on = !this.on;
          },
        });
        Alpine.store('primitiveVal', true);
        // Array.from({ length: 20 }).forEach(() => {
        //   Alpine.store(Math.random().toFixed(2), { foo: 'bar' });
        // });
      });
    </script>
    <div x-data>
      <button data-testid="reset-nested-store" @click="$store.sampleStore.nested = []">
        Reset nested store
      </button>
    </div>
    <div x-data>
      <button data-testid="reset-primitive-store" @click="$store.primitiveVal = false">
        Reset primitive store
      </button>
    </div>

    <h3>Manual test</h3>
    <p>
      Can't reproduce
      <a href="https://github.com/alpinejs/alpine/discussions/1952"
        >https://github.com/alpinejs/alpine/discussions/1952</a
      >
    </p>
    <div x-data @focus-input.window="$refs.searchInput.focus()">
      <input x-ref="searchInput" />
    </div>
    <button onclick="document.dispatchEvent(new CustomEvent('focus-input'))">Click</button>
  </body>
</html>
