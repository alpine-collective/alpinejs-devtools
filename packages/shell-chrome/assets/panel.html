<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <!-- configured in rollup.config.js -->
        <link rel="stylesheet" href="./styles.css" />
        <style>
            .arrow {
                display: inline-block;
                width: 0;
                height: 0;
            }

            .right {
                border-top: 4px solid transparent;
                border-bottom: 4px solid transparent;
                border-left: 6px solid #444;
            }

            .down {
                border-left: 4px solid transparent;
                border-right: 4px solid transparent;
                border-top: 6px solid #444;
            }

            [x-cloak] {
                display: none;
            }

            /* Preload */
            body {
                margin: 0;
                padding: 0;
            }
            .preload {
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100vh;
                color: #888;
                background-color: #eee;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell,
                    'Open Sans', 'Helvetica Neue', sans-serif;
                padding: 20px;
            }
        </style>
    </head>

    <body class="antialiased">
        <div x-data x-show="false" class="preload">Devtools loading...</div>

        <div
            id="app"
            x-cloak
            x-data="{
        version: null,
        latest: null,
        components : [],
        showTools: false,
        showTimeout: 1500,
        activeTheme: 'dark-header',

        themes: {
            light: {
                'text-header': 'text-alpine-400',
                'bg-header': 'bg-white',
                'bg-logo-dark': 'text-alpine-400',
                'bg-logo-light': 'text-silver-600',
            },

            'dark-header': {
                'text-header': 'text-white',
                'bg-header': 'bg-alpine-400',
                'bg-logo-dark': 'text-ice-500',
                'bg-logo-light': 'text-silver-500',
            },
        },

        get isLatest() {
            if (!this.version || !this.latest) return null;
            const requiredArray = this.latest.split('.').map(v => parseInt(v, 10));
            const currentArray = this.version.split('.').map(v => parseInt(v, 10));
            for (let i = 0; i < requiredArray.length; i++) {
                if (!currentArray[i] || currentArray[i] < requiredArray[i]) {
                    return false;
                }
                if (currentArray[i] > requiredArray[i]) {
                    return true;
                }
            }
            return true
        },

        get detected(){
            if (!this.showTools) {
                return 'Alpine.js tools loading'
            }

            return this.version ? `Alpine.js v${this.version} detected` : 'Alpine.js <v2.3.1 detected'
        },

        get openComponent () {
            return this.components.filter(component => {
                return component.isOpened
            })[0] || {}
        },

        get theme(){
            return this.themes[this.activeTheme]
        },
    }"
            x-init="() => {
        $watch('components', () => {
            if (!showTools && components.length > 0) {
                fetchWithTimeout('https://registry.npmjs.com/alpinejs', { timeout: showTimeout })
                    .then((data) => {
                        latest = data['dist-tags'].latest;
                        showTools = true;
                    }).catch(error => {
                        console.error('Could not load Alpine.js version data from registry.npmjs.com');
                        // latest will be as defaulted in state.js
                        showTools = true
                    })
            }
        })
    }"
        >
            <div class="bg-white flex flex-col relative h-screen w-full mx-auto">
                <div
                    :class="{
                'bg-gray-100': !showTools,
                [theme['bg-header']]: showTools,
            }"
                    class="flex py-2 pl-3 pr-4 text-base leading-9 tracking-tight font-bold text-white border-b border-gray-300 transition duration-700 transition-colors ease-in-out sm:leading-10"
                >
                    <div class="flex-1">
                        <div class="flex items-center">
                            <svg
                                class="w-10 h-10 mr-3"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 460 460"
                                fill="currentColor"
                                stroke="none"
                            >
                                <!-- <rect class="text-gray-100" x="0" y="0" width="460" height="460"></rect> -->
                                <polygon
                                    :class="{
                                'text-gray-600': !showTools,
                                [theme['bg-logo-dark']]: showTools,
                            }"
                                    class="transform transition-colors duration-700"
                                    points="50,230 140,140 320,320 140,320"
                                />
                                <polygon
                                    :class="{
                                'text-gray-400': !showTools,
                                [theme['bg-logo-light']]: showTools,
                            }"
                                    class="transform transition-colors duration-700"
                                    points="320,140 410,230 320,320 230,230"
                                />
                            </svg>

                            <div
                                :class="{
                            'animate-pulse-fast': !showTools,
                            'bg-gray-300 bg-opacity-50 text-gray-600': !showTools,
                            'bg-green-100 text-green-700': showTools && isLatest,
                            'bg-orange-100 text-orange-700': showTools && !isLatest,
                        }"
                                class="flex items-center px-1 py-0.5 rounded text-xs font-medium leading-4 transition transition-colors duration-700 ease-in-out"
                                :title="isLatest? 'Latest Version' : `Latest Version: ${latest}`"
                            >
                                <svg
                                    :class="{
                                'text-gray-400': !showTools ,
                                'text-green-500': showTools && isLatest,
                                'text-orange-500': showTools && !isLatest,
                            }"
                                    class="mr-1.5 h-2 w-2 transition transition-colors duration-700 ease-in-out"
                                    fill="currentColor"
                                    viewBox="0 0 8 8"
                                >
                                    <circle cx="4" cy="4" r="3" />
                                </svg>
                                <a
                                    :class="isLatest ? 'pointer-events-none' : ''"
                                    :href="isLatest ? '#' : 'https://github.com/alpinejs/alpine/releases'"
                                    x-text="detected"
                                ></a>
                            </div>
                        </div>
                    </div>

                    <div
                        :class="{
                    'text-gray-400': !showTools,
                    [theme['text-header']]: showTools,
                }"
                        class="flex items-center space-x-2 transition transition-colors duration-700"
                    >
                        <a
                            href="https://github.com/alpinejs/alpine"
                            target="_blank"
                            title="Alpine.js Docs"
                            class="hover:opacity-75"
                        >
                            <svg
                                class="w-6 h-6"
                                fill="currentColor"
                                viewBox="0 0 20 20"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z"
                                    clip-rule="evenodd"
                                ></path>
                            </svg>
                        </a>
                        <a
                            href="https://github.com/alpine-collective/alpinejs-devtools"
                            target="_blank"
                            title="Alpine Collective GitHub"
                            class="hover:opacity-75"
                        >
                            <svg class="fill-current w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                <path
                                    d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"
                                ></path>
                            </svg>
                        </a>
                    </div>
                </div>

                <div
                    :class="{
                'opacity-75': !showTools,
            }"
                    class="flex-1 flex flex-col sm:flex-row overflow-hidden"
                >
                    <div class="flex-1 flex flex-col max-h-full sm:border-r border-gray-300 overflow-scroll">
                        <div
                            :class="{
                        'hidden': !showTools,
                    }"
                            class="p-2"
                        >
                            <template x-for="(component, index) in components">
                                <a
                                    :class="{
                                    'text-white bg-alpine-300' : component.isOpened,
                                    'text-gray-600 hover:bg-blue-100' : !component.isOpened,
                                }"
                                    class="block cursor-pointer rounded"
                                    :style="`padding-left: ${component.depth * 20}px; `"
                                    @mouseenter="alpineState.hoverOnComponent(component)"
                                    @mouseleave="alpineState.hoverLeftComponent(component)"
                                    @click=" alpineState.renderComponentData(component)"
                                >
                                    <h5 class="flex items-center px-2 leading-7 font-mono">
                                        <span class="opacity-25">&lt;</span>
                                        <span
                                            data-testid="component-name"
                                            x-text="component.name"
                                            class="text-base"
                                        ></span>
                                        <span class="opacity-25">&gt;</span>
                                    </h5>
                                </a>
                            </template>
                        </div>
                    </div>

                    <div
                        class="flex-1 relative flex flex-col max-h-full border-t border-gray-300 sm:border-t-0 overflow-scroll"
                    >
                        <template x-if="openComponent.name">
                            <div
                                class="sticky top-0 left-0 z-20 w-full flex items-center px-3 py-2 text-base font-mono text-gray-600 bg-gray-100"
                            >
                                <span class="opacity-25">&lt;</span>
                                <span x-text="openComponent.name"></span>
                                <span class="opacity-25">&gt;</span>
                            </div>
                        </template>

                        <template x-if="!openComponent.name">
                            <div
                                x-text="showTools? 'Select a component to view' : ''"
                                class="flex h-full w-full items-center justify-center p-4 text-gray-400 text-sm bg-gray-50"
                            ></div>
                        </template>

                        <div class="flex-1 px-3 py-2">
                            <template x-for="(singleComponent, componentIndex) in components">
                                <div x-show="singleComponent.isOpened" class="font-mono">
                                    <div class="leading-6 text-gray-300">x-data: {</div>

                                    <div>
                                        <template x-for="(singleData, index) in singleComponent.flattenedData">
                                            <div class="group flex items-center">
                                                <a
                                                    :style="`margin-left: ${singleData.depth}px; `"
                                                    @click="alpineState.toggleDataAttribute(singleData)"
                                                    class="block px-1 rounded"
                                                    :class="{
                                                    'hover:bg-blue-100 cursor-pointer': !singleData.readOnly
                                                }"
                                                    x-show="singleData.isOpened"
                                                >
                                                    <h5
                                                        data-testid="data-property"
                                                        class="flex items-center relative pl-3 leading-6 text-sm"
                                                    >
                                                        <div class="absolute left-0 h-full flex items-center">
                                                            <span
                                                                x-show="singleData.hasArrow"
                                                                class="arrow"
                                                                :data-testid="singleData.isArrowDown ? 'arrow-down' : 'arrow-right'"
                                                                :class="{
                                                            'right': !singleData.isArrowDown,
                                                            'down': singleData.isArrowDown
                                                        }"
                                                            ></span>
                                                        </div>

                                                        <span
                                                            style="color: #881391"
                                                            x-text="singleData.attributeName"
                                                            data-testid="data-property-name"
                                                        ></span>

                                                        <span class="text-black">:</span>

                                                        <div class="text-black ml-1" x-show="!singleData.inEditingMode">
                                                            <template x-if="singleData.dataType == 'string'">
                                                                &quot;<span
                                                                    class="text-red-700"
                                                                    x-text="singleData.attributeValue"
                                                                    data-testid="data-property-value"
                                                                ></span
                                                                >&quot;
                                                            </template>

                                                            <template x-if="singleData.dataType == 'boolean'">
                                                                <span
                                                                    class="text-blue-700"
                                                                    x-text="singleData.attributeValue"
                                                                    data-testid="data-property-value"
                                                                ></span>
                                                            </template>

                                                            <template
                                                                x-if="['string', 'boolean'].includes(singleData.dataType) === false"
                                                            >
                                                                <span
                                                                    x-text="singleData.attributeValue"
                                                                    data-testid="data-property-value"
                                                                ></span>
                                                            </template>
                                                        </div>
                                                    </h5>
                                                </a>

                                                <div
                                                    class="flex flex-col"
                                                    x-show="!singleData.hasArrow
                                                    && !singleData.readOnly
                                                    && singleData.isOpened"
                                                >
                                                    <svg
                                                        fill="currentColor"
                                                        x-show="!singleData.inEditingMode
                                                        && singleData.dataType !== 'boolean'"
                                                        data-testid="edit-icon"
                                                        @click="alpineState.editAttribute(singleData)"
                                                        viewBox="0 0 20 20"
                                                        class="w-4 h-4 cursor-pointer opacity-0 group-hover:opacity-100 hover:opacity-75"
                                                    >
                                                        <path
                                                            d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                                                        ></path>
                                                    </svg>

                                                    <template x-if="singleData.dataType == 'boolean'">
                                                        <input
                                                            type="checkbox"
                                                            x-model="singleData.editAttributeValue"
                                                            @change.stop="$nextTick(() => alpineState.saveEditing(singleData))"
                                                            class="form-checkbox h-4 w-4 text-blue-700 transition duration-150 ease-in-out opacity-0 group-hover:opacity-100"
                                                        />
                                                    </template>

                                                    <template x-if="singleData.dataType !== 'boolean'">
                                                        <div
                                                            x-show="singleData.inEditingMode"
                                                            class="flex flex-row items-center"
                                                        >
                                                            <input
                                                                @keydown.enter.stop="alpineState.saveEditing(singleData)"
                                                                @keydown.escape.stop="alpineState.cancelEditing(singleData)"
                                                                class="flex text-gray-700 leading-tight focus:outline-none focus:shadow-outline w-2/3 shadow appearance-none border rounded py-1 px-1"
                                                                type="text"
                                                                x-model="singleData.editAttributeValue"
                                                            />

                                                            <svg
                                                                fill="currentColor"
                                                                data-testid="save-icon"
                                                                @click="alpineState.saveEditing(singleData)"
                                                                viewBox="0 0 20 20"
                                                                class="flex w-5 h-5 cursor-pointer ml-2 hover:opacity-75"
                                                            >
                                                                <path
                                                                    fill-rule="evenodd"
                                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                                    clip-rule="evenodd"
                                                                ></path>
                                                            </svg>

                                                            <svg
                                                                fill="currentColor"
                                                                data-testid="cancel-icon"
                                                                @click="alpineState.cancelEditing(singleData)"
                                                                viewBox="0 0 20 20"
                                                                class="flex w-5 h-5 ml-1 cursor-pointer hover:opacity-75"
                                                            >
                                                                <path
                                                                    fill-rule="evenodd"
                                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                                    clip-rule="evenodd"
                                                                ></path>
                                                            </svg>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                    <div class="leading-7 text-gray-300">}</div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="./panel.js"></script>
    </body>
</html>
